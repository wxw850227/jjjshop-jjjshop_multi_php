import{E as e,q as l,r as a,d as o,e as t,s as d,t as r,p as i,f as s,i as u,j as p,u as m,c,v as n}from"./element-plus-1d28f1d0.js";import{_}from"./category-c9f65c60.js";import{_ as f}from"./Product-6d85ea8c.js";import{c as y,e as g}from"./coupon-eef4d6a0.js";import{_ as b,m as h}from"./index-3957abef.js";import{an as V,$ as v,o as j,c as k,P as x,S as C,Q as U,W as w,Y as D,T as I,a as z,a9 as q,X as F,bh as $,bf as N}from"./@vue-fcfaff04.js";import"./lodash-es-493ac664.js";import"./async-validator-cf877c1f.js";import"./@vueuse-28c84072.js";import"./dayjs-3f6c138b.js";import"./call-bind-a6dd5c06.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-6c014c7f.js";import"./escape-html-d3e23fdb.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./product-248f65bb.js";import"./vue-router-0cda4647.js";import"./pinia-234ab43f.js";import"./axios-63583d02.js";import"./vue-ueditor-wrap-33bac798.js";import"./qs-edfbe083.js";import"./side-channel-6da5de8a.js";import"./object-inspect-66d569d0.js";const P={components:{Product:f,Category:_},data:()=>({activeName:"1",form:{coupon_id:"",name:"",color:"",coupon_type:"",reduce_price:"",discount:"",min_price:"",expire_type:"",expire_day:"",active_time:"",total_num:"",sort:1,free_limit:0,apply_range:10,product:[]},list:{},loading:!0,pickerOptions0:{disabledDate:e=>e.getTime()<Date.now()-864e5},category:[],prodcutData:[],isproduct:!1,is_category:!1,is_product:!1,exclude_ids:[],product_list:[],category_list:{second:[],first:[]},category_ids:[]}),created(){let e=this.$route.query.coupon_id;this.getData(e)},methods:{getData(e){let l=this;y({coupon_id:e}).then((e=>{let a={};if(a=e.data.detail,a.color=e.data.detail.color.value,a.coupon_type=e.data.detail.coupon_type.value,l.form=h(l.form,a),20==l.form.apply_range){l.exclude_ids=e.data.detail.product_ids;for(let e=0;e<l.exclude_ids.length;e++)l.exclude_ids[e]=parseInt(l.exclude_ids[e]);l.product_list=e.data.detail.product_list}30==l.form.apply_range&&(l.category_list=e.data.detail.category_list),l.loading=!1})).catch((e=>{l.loading=!1}))},onSubmit(){let l=this,a=l.form;a.product_ids=l.exclude_ids,a.category_list=l.category_list,l.$refs.form.validate((o=>{if(o){if(20==a.coupon_type&&(a.discount<=0||a.discount>=10))return void e({message:"折扣率介于0和10之间",type:"error"});l.loading=!0,g(a).then((a=>{l.loading=!1,e({message:"恭喜你，修改成功",type:"success"}),l.$router.push("/coupon/coupon/index")})).catch((e=>{l.loading=!1}))}else l.loading=!1}))},hasImages:e=>e||"",cancelFunc(){this.$router.push({path:"/coupon/coupon/index"})},closeCategoryFunc(e){let l=this;l.is_category=!1,e&&(l.category_list=e)},closeProductFunc(e){let l=this;l.is_product=e.openDialog,"success"==e.type&&e.params.forEach(((e,a)=>{let o={product_id:e.product_id,product_name:e.product_name,product_image:e.image};l.exclude_ids.push(o.product_id),l.product_list.push(o)}))},deleteClick(e){this.exclude_ids.splice(e,1),this.product_list.splice(e,1)}}},Y=e=>($("data-v-6b4eb0ac"),e=e(),N(),e),S=Y((()=>z("div",{class:"common-form"},"修改优惠券",-1))),E=Y((()=>z("div",{class:"tips"},"例如：满100减10",-1))),M={key:0},O={key:1},T=Y((()=>z("div",{class:"tips"},"折扣率范围0-10，9.5代表9.5折，整数或1位小数",-1))),Q={key:2},W={key:3},X=Y((()=>z("div",{class:"tips"},"限制领取的优惠券数量，-1为不限制",-1))),A=Y((()=>z("div",{class:"tips"},"促销是指满减，等级优惠券值商品的会员等级折扣",-1))),B=Y((()=>z("div",{class:"common-form"},"适用商品",-1))),G=Y((()=>z("span",null,"指定商品",-1))),H=Y((()=>z("span",null,"指定分类",-1))),J={alt:"",width:50,height:50},K={class:"ww100"},L={class:"common-button-wrapper"};const R=b(P,[["render",function(e,y,g,b,h,$){const N=l,P=a,Y=o,R=t,Z=d,ee=r,le=i,ae=s,oe=u,te=p,de=m,re=c,ie=f,se=_,ue=V("img-url"),pe=n;return v((j(),k("div",null,[x(re,{size:"small",ref:"form",model:h.form,"label-width":"200px"},{default:C((()=>[x(P,{modelValue:h.activeName,"onUpdate:modelValue":y[0]||(y[0]=e=>h.activeName=e),type:"card"},{default:C((()=>[x(N,{label:"基本信息",name:"1"}),x(N,{label:"适用商品",name:"2"})])),_:1},8,["modelValue"]),"1"==h.activeName?(j(),k(U,{key:0},[S,x(R,{label:"优惠券名称",prop:"name",rules:[{required:!0,message:" "}]},{default:C((()=>[x(Y,{modelValue:h.form.name,"onUpdate:modelValue":y[1]||(y[1]=e=>h.form.name=e),placeholder:"请输入优惠券名称"},null,8,["modelValue"]),E])),_:1}),x(R,{label:"优惠券颜色"},{default:C((()=>[x(ee,{modelValue:h.form.color,"onUpdate:modelValue":y[2]||(y[2]=e=>h.form.color=e)},{default:C((()=>[x(Z,{label:10},{default:C((()=>[w("蓝色")])),_:1}),x(Z,{label:20},{default:C((()=>[w("红色")])),_:1}),x(Z,{label:30},{default:C((()=>[w("紫色")])),_:1}),x(Z,{label:40},{default:C((()=>[w("黄色")])),_:1})])),_:1},8,["modelValue"])])),_:1}),x(R,{label:"优惠券类型"},{default:C((()=>[x(ee,{modelValue:h.form.coupon_type,"onUpdate:modelValue":y[3]||(y[3]=e=>h.form.coupon_type=e)},{default:C((()=>[x(Z,{label:10},{default:C((()=>[w("满减券")])),_:1}),x(Z,{label:20},{default:C((()=>[w("折扣券")])),_:1})])),_:1},8,["modelValue"])])),_:1}),10==h.form.coupon_type?(j(),k("div",M,[x(R,{label:"减免金额"},{default:C((()=>[x(Y,{modelValue:h.form.reduce_price,"onUpdate:modelValue":y[4]||(y[4]=e=>h.form.reduce_price=e),placeholder:"请输入减免金额",type:"number"},null,8,["modelValue"])])),_:1})])):(j(),k("div",O,[x(R,{label:"折扣率 "},{default:C((()=>[x(Y,{modelValue:h.form.discount,"onUpdate:modelValue":y[5]||(y[5]=e=>h.form.discount=e),placeholder:"请输入折扣率",type:"number"},null,8,["modelValue"]),T])),_:1})])),x(R,{label:"最低消费金额"},{default:C((()=>[x(Y,{modelValue:h.form.min_price,"onUpdate:modelValue":y[6]||(y[6]=e=>h.form.min_price=e),placeholder:"请输入最低消费金额",type:"number"},null,8,["modelValue"])])),_:1}),x(R,{label:"到期类型"},{default:C((()=>[x(ee,{modelValue:h.form.expire_type,"onUpdate:modelValue":y[7]||(y[7]=e=>h.form.expire_type=e)},{default:C((()=>[x(Z,{label:10},{default:C((()=>[w("领取后生效")])),_:1}),x(Z,{label:20},{default:C((()=>[w("固定时间")])),_:1})])),_:1},8,["modelValue"])])),_:1}),10==h.form.expire_type?(j(),k("div",Q,[x(R,{label:"有效天数"},{default:C((()=>[x(Y,{modelValue:h.form.expire_day,"onUpdate:modelValue":y[8]||(y[8]=e=>h.form.expire_day=e),placeholder:"请输入有效天数",type:"number"},null,8,["modelValue"])])),_:1})])):(j(),k("div",W,[x(R,{label:"有效时间"},{default:C((()=>[x(le,{modelValue:h.form.active_time,"onUpdate:modelValue":y[9]||(y[9]=e=>h.form.active_time=e),type:"daterange",align:"right","unlink-panels":"","value-format":"YYYY-MM-DD","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":h.pickerOptions0},null,8,["modelValue","picker-options"])])),_:1})])),x(R,{label:"发放总数量 ",prop:"total_num",rules:[{required:!0,message:" "}]},{default:C((()=>[x(Y,{modelValue:h.form.total_num,"onUpdate:modelValue":y[10]||(y[10]=e=>h.form.total_num=e),placeholder:"请输入发放总数量",type:"number"},null,8,["modelValue"]),X])),_:1}),x(R,{label:"使用条件"},{default:C((()=>[x(ee,{modelValue:h.form.free_limit,"onUpdate:modelValue":y[11]||(y[11]=e=>h.form.free_limit=e)},{default:C((()=>[x(Z,{label:0},{default:C((()=>[w("不限制")])),_:1}),x(Z,{label:1},{default:C((()=>[w("不可与促销同时使用")])),_:1}),x(Z,{label:2},{default:C((()=>[w("不可与等级优惠同时使用")])),_:1}),x(Z,{label:3},{default:C((()=>[w("不可于促销和等级优惠同时使用")])),_:1})])),_:1},8,["modelValue"]),A])),_:1}),x(R,{label:"排序"},{default:C((()=>[x(Y,{type:"number",modelValue:h.form.sort,"onUpdate:modelValue":y[12]||(y[12]=e=>h.form.sort=e),placeholder:"请输入排序"},null,8,["modelValue"])])),_:1})],64)):D("",!0),"2"==h.activeName?(j(),k(U,{key:1},[B,x(R,{label:"选择"},{default:C((()=>[x(ee,{modelValue:h.form.apply_range,"onUpdate:modelValue":y[13]||(y[13]=e=>h.form.apply_range=e)},{default:C((()=>[x(Z,{label:10},{default:C((()=>[w("全部商品")])),_:1}),x(Z,{label:20},{default:C((()=>[G])),_:1}),x(Z,{label:30},{default:C((()=>[H])),_:1})])),_:1},8,["modelValue"])])),_:1}),20==h.form.apply_range?(j(),I(R,{key:0},{default:C((()=>[x(ae,{class:"mb10",onClick:y[14]||(y[14]=e=>h.is_product=!0),type:"primary",plain:""},{default:C((()=>[w("添加商品 ")])),_:1}),h.product_list.length>0?(j(),I(te,{key:0,data:h.product_list,"max-height":"400",border:"",style:{width:"100%"}},{default:C((()=>[x(oe,{prop:"product_id",label:"ID",width:"180"}),x(oe,{prop:"product_name",label:"商品名称",width:"180"}),x(oe,{prop:"image",label:"图片"},{default:C((e=>[v(z("img",J,null,512),[[ue,$.hasImages(e.row.product_image)]])])),_:1}),x(oe,{label:"操作"},{default:C((e=>[x(ae,{onClick:l=>$.deleteClick(e.$index),link:"",type:"primary",size:"small"},{default:C((()=>[w("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])):D("",!0)])),_:1})):D("",!0),30==h.form.apply_range?(j(),I(R,{key:1,label:""},{default:C((()=>[x(ae,{class:"mb10",onClick:y[15]||(y[15]=e=>h.is_category=!0),type:"primary",plain:""},{default:C((()=>[w("添加分类")])),_:1}),z("div",K,[h.category_list.first.length>0?(j(!0),k(U,{key:0},q(h.category_list.first,(e=>(j(),I(de,{class:"mr10 mb10",type:"info",size:"large",key:e.category_id},{default:C((()=>[w(F(e.parent?e.parent+"→"+e.name:e.name),1)])),_:2},1024)))),128)):D("",!0),h.category_list.second.length>0?(j(!0),k(U,{key:1},q(h.category_list.second,(e=>(j(),I(de,{class:"mr10 mb10",type:"info",size:"large",key:e.category_id},{default:C((()=>[w(F(e.parent?e.parent+"→"+e.name:e.name),1)])),_:2},1024)))),128)):D("",!0)])])),_:1})):D("",!0)],64)):D("",!0),z("div",L,[x(ae,{type:"info",size:"small",onClick:$.cancelFunc,loading:h.loading},{default:C((()=>[w("取消")])),_:1},8,["onClick","loading"]),x(ae,{type:"primary",size:"small",onClick:$.onSubmit,loading:h.loading},{default:C((()=>[w("提交")])),_:1},8,["onClick","loading"])])])),_:1},8,["model"]),x(ie,{isproduct:h.is_product,excludeIds:h.exclude_ids,islist:!0,onCloseDialog:$.closeProductFunc},null,8,["isproduct","excludeIds","onCloseDialog"]),x(se,{is_category:h.is_category,excludeIds:h.category_ids,onClose:$.closeCategoryFunc},null,8,["is_category","excludeIds","onClose"])])),[[pe,h.loading]])}],["__scopeId","data-v-6b4eb0ac"]]);export{R as default};
