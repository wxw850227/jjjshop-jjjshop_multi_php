import{E as e,d as a,e as r,s as t,i as l,j as o,f as i,c as s}from"./element-plus-1d28f1d0.js";import{f as d,g as n}from"./setting-9ca83d13.js";import u from"./Area-d5b558a0.js";import{_ as m,n as f}from"./index-3957abef.js";import{ae as p,o as c,c as h,P as y,S as _,Y as v,a as w,W as g,Q as b,a9 as j,X as k,T as V}from"./@vue-fcfaff04.js";import"./lodash-es-493ac664.js";import"./async-validator-cf877c1f.js";import"./@vueuse-28c84072.js";import"./dayjs-3f6c138b.js";import"./call-bind-a6dd5c06.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-6c014c7f.js";import"./escape-html-d3e23fdb.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./vue-router-0cda4647.js";import"./pinia-234ab43f.js";import"./axios-63583d02.js";import"./vue-ueditor-wrap-33bac798.js";import"./qs-edfbe083.js";import"./side-channel-6da5de8a.js";import"./object-inspect-66d569d0.js";const C={components:{Area:u},data:()=>({form:{delivery_id:0,method:"10",name:"",sort:1,radio:"10",rule:[]},formRules:{name:[{required:!0,message:" ",trigger:"blur"}]},loading:!1,options:[],optionsMap:{},areaModel:{},show_area:!1,tableHeadName:{first:"首件(个)",first_fee:"运费(元)",additional:"续件(个)",additional_fee:"续费(元)"},cityCount:0,formData:[]}),watch:{"form.radio":function(e,a){this.tableHeadName="10"==e?{first:"首件(个)",first_fee:"运费(元)",additional:"续件(个)",additional_fee:"续费(元)"}:{first:"首重(Kg)",first_fee:"运费(元)",additional:"续重(Kg)",additional_fee:"续费(元)"}},"form.rule":{handler(e,a){},deep:!0}},created(){this.delivery_id=this.$route.query.delivery_id,this.getData()},methods:{getData(){let e=this;d({delivery_id:e.delivery_id}).then((a=>{if(e.delivery_id>0&&(e.form=a.data.detail||[],e.form.radio=e.form.method.value.toString(),e.formData=a.data.formData),e.options=a.data.arr,e.cityCount=a.data.cityCount,e.options.forEach((function(a){e.optionsMap[a.value]=a})),!e.formData.length)return!1;e.formData.forEach((function(a){for(var r in a.citys)a.citys.hasOwnProperty(r)&&(a.citys[r]=parseInt(a.citys[r]));a.showData=e.getShowData({province:a.province,citys:a.citys}),e.form.rule.push(a)}))})).catch((e=>{}))},getShowData:function(e){var a=this,r={};return e.province.forEach((function(t){var l=a.optionsMap[t],o=[],i=0;for(var s in l.children)if(l.children.hasOwnProperty(s)){var d=l.children[s];a.inArray(d.value,e.citys)&&o.push({id:d.value,name:d.label}),i++}r[l.value]={id:l.value,name:l.label,citys:o,isAllCitys:o.length===i}})),r},inArray:function(e,a){return a.indexOf(e)>-1},addAreaClick(e){this.areaModel.index=this.form.rule.length,this.areaModel.type="add",this.show_area=!0},editAreaClick(e){this.areaModel.index=e,this.areaModel.type="edit",this.show_area=!0},closeAreaFunc(e){if(this.show_area=e.statu,"confirm"!=e.type)return;let a=[],r=[];e.this_area.forEach((function(e){a.push(e.value),e.children.forEach((function(e){r.push(e.value)}))})),"add"==this.areaModel.type&&this.form.rule.push({first:"",first_fee:"",additional:"",additional_fee:"",citys:r,showData:this.getShowData({province:a,citys:r})}),"edit"==this.areaModel.type&&(this.form.rule[this.areaModel.index].showData=this.getShowData({province:a,citys:r}),this.form.rule[this.areaModel.index].citys=r),this.form.rule.push([]),this.form.rule.pop()},deleteAreaClick(e){let a=this;a.options.forEach((function(r){a.inArray(r.value,a.form.rule[e].province)&&(r.checked=!1,r.index=null),r.children.forEach((function(r){a.inArray(r.value,a.form.rule[e].citys)&&(r.checked=!1,r.index=null)}))})),a.form.rule.splice(e,1)},onSubmit(){let a=this,r=f(a.form);r.rule.forEach((function(e){delete e.showData})),a.$refs.form.validate((t=>{if(t){if(0==r.rule.length)return e({message:"请添加配送区域和运费",type:"error"}),!1;for(let a in r.rule){if(!(r.rule[a].hasOwnProperty("first")&&r.rule[a].first>0))return e({message:"首件/首重不能为空",type:"error"}),!1;if(!r.rule[a].hasOwnProperty("first_fee")||""==r.rule[a].first_fee)return e({message:"运费不能为空",type:"error"}),!1;if(!(r.rule[a].hasOwnProperty("additional")&&r.rule[a].additional>0))return e({message:"续件/续重不能为空",type:"error"}),!1;if(!r.rule[a].hasOwnProperty("additional_fee")||""==r.rule[a].additional_fee)return e({message:"续费不能为空",type:"error"}),!1}a.loading=!0,n(r).then((r=>{a.loading=!1,e({message:"恭喜你，修改成功",type:"success"}),a.$router.push("/setting/delivery/index")})).catch((e=>{a.loading=!1}))}}))}}},x={class:"product-add"},A={key:0,class:"common-form"},D={key:1,class:"common-form"},M={class:"area-list"},U={key:0},E={class:"am-link-muted gray9"},S={key:0},O=["onClick"],P=["onClick"],H=w("div",{class:"tips"},"数字越小越靠前",-1),N={class:"common-button-wrapper"};const $=m(C,[["render",function(e,d,n,u,m,f){const C=a,$=r,q=t,z=l,F=o,K=i,R=s,I=p("Area");return c(),h("div",x,[y(R,{size:"small",ref:"form",model:m.form,rules:m.formRules,"label-width":"200px"},{default:_((()=>[0==e.delivery_id?(c(),h("div",A,"新增运费模版")):v("",!0),e.delivery_id>0?(c(),h("div",D,"修改运费模版")):v("",!0),y($,{label:"模版名称",prop:"name"},{default:_((()=>[y(C,{modelValue:m.form.name,"onUpdate:modelValue":d[0]||(d[0]=e=>m.form.name=e),class:"max-w460"},null,8,["modelValue"])])),_:1}),y($,{label:"计费方式"},{default:_((()=>[w("div",null,[y(q,{modelValue:m.form.radio,"onUpdate:modelValue":d[1]||(d[1]=e=>m.form.radio=e),label:"10"},{default:_((()=>[g("按件数")])),_:1},8,["modelValue"]),y(q,{modelValue:m.form.radio,"onUpdate:modelValue":d[2]||(d[2]=e=>m.form.radio=e),label:"20"},{default:_((()=>[g("按重量")])),_:1},8,["modelValue"])])])),_:1}),y($,{label:"配送区域及运费"},{default:_((()=>[y(F,{data:m.form.rule,border:"",style:{width:"100%"}},{default:_((()=>[y(z,{label:"可配送区域"},{default:_((a=>[w("div",M,[a.row.citys.length==m.cityCount?(c(),h("span",U,"全国")):(c(!0),h(b,{key:1},j(a.row.showData,((e,a)=>(c(),h("span",{key:a,class:"pr16"},[g(k(e.name)+" ",1),e.isAllCitys?v("",!0):(c(),h(b,{key:0},[g(" ("),w("span",E,[(c(!0),h(b,null,j(e.citys,((a,r)=>(c(),h("em",{key:r},[w("span",null,k(a.name),1),r+1<e.citys.length?(c(),h("span",S,"、")):v("",!0)])))),128))]),g(") ")],64))])))),128))]),w("a",{href:"javascript:void(0);",onClick:r=>e.el=f.editAreaClick(a.$index)},"编辑",8,O)])),_:1}),y(z,{prop:"first",label:m.tableHeadName.first,width:"100px"},{default:_((e=>[y(C,{modelValue:e.row.first,"onUpdate:modelValue":a=>e.row.first=a},null,8,["modelValue","onUpdate:modelValue"])])),_:1},8,["label"]),y(z,{prop:"first_fee",label:m.tableHeadName.first_fee,width:"100px"},{default:_((e=>[y(C,{modelValue:e.row.first_fee,"onUpdate:modelValue":a=>e.row.first_fee=a},null,8,["modelValue","onUpdate:modelValue"])])),_:1},8,["label"]),y(z,{prop:"additional",label:m.tableHeadName.additional,width:"100px"},{default:_((e=>[y(C,{modelValue:e.row.additional,"onUpdate:modelValue":a=>e.row.additional=a},null,8,["modelValue","onUpdate:modelValue"])])),_:1},8,["label"]),y(z,{prop:"additional_fee",label:m.tableHeadName.additional_fee,width:"100px"},{default:_((e=>[y(C,{modelValue:e.row.additional_fee,"onUpdate:modelValue":a=>e.row.additional_fee=a},null,8,["modelValue","onUpdate:modelValue"])])),_:1},8,["label"]),y(z,{label:"操作",width:"60px"},{default:_((e=>[w("a",{href:"javascript:void(0);",onClick:a=>f.deleteAreaClick(e.$index)},"删除",8,P)])),_:1})])),_:1},8,["data"]),w("div",null,[y(K,{onClick:f.addAreaClick,link:"",type:"primary",size:"small"},{default:_((()=>[g("+点击添加可配送区域和运费")])),_:1},8,["onClick"])])])),_:1}),y($,{label:"排序"},{default:_((()=>[y(C,{modelValue:m.form.sort,"onUpdate:modelValue":d[3]||(d[3]=e=>m.form.sort=e),type:"number",class:"max-w460"},null,8,["modelValue"]),H])),_:1}),w("div",N,[y(K,{type:"primary",onClick:f.onSubmit,loading:m.loading},{default:_((()=>[g("提交")])),_:1},8,["onClick","loading"])])])),_:1},8,["model","rules"]),m.show_area?(c(),V(I,{key:0,show_area:m.show_area,areaModel:m.areaModel,areas:m.options,onCloseArea:f.closeAreaFunc},null,8,["show_area","areaModel","areas","onCloseArea"])):v("",!0)])}]]);export{$ as default};
