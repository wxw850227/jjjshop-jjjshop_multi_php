import{D as e,F as a,l as t,a as l,E as s,x as r,d as o,e as i,n as d,o as n,p as c,f as p,c as u,q as m,u as _,r as y,i as g,j as h,k as v,G as f,A as k,v as b}from"./element-plus-1d28f1d0.js";import{f as C,q as x,w as D,g as w}from"./order-c84ec710.js";import{_ as j,u as z}from"./index-3957abef.js";import{o as V,T as F,S as L,P as S,c as U,Q as B,a9 as I,W as E,X as N,ae as P,an as q,a as M,$ as Y,M as $,Y as T}from"./@vue-fcfaff04.js";import"./qs-edfbe083.js";import A from"./cancel-da755538.js";import"./lodash-es-493ac664.js";import"./async-validator-cf877c1f.js";import"./@vueuse-28c84072.js";import"./dayjs-3f6c138b.js";import"./call-bind-a6dd5c06.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-6c014c7f.js";import"./escape-html-d3e23fdb.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./vue-router-0cda4647.js";import"./pinia-234ab43f.js";import"./axios-63583d02.js";import"./vue-ueditor-wrap-33bac798.js";import"./side-channel-6da5de8a.js";import"./object-inspect-66d569d0.js";import"./vuedraggable-392a59b1.js";import"./vue-de83683b.js";import"./sortablejs-808289a9.js";const G=j({data:()=>({dialogVisible:!1,type:"error",params:null,reverse:!1,order_id:0,activities:[]}),props:["isLogistics","logisticsData"],watch:{isLogistics:function(e,a){e!=a&&e&&(this.dialogVisible=e,this.type="error")},logisticsData:function(e,a){e!=a&&e&&(this.activities=e)}},methods:{getData(){let e={order_id:this.order_id};C(e).then((e=>{})).catch((e=>{}))},dialogFormVisible(){this.$emit("closeDialog",{type:this.type,openDialog:!1,params:this.params})}}},[["render",function(l,s,r,o,i,d){const n=e,c=a,p=t;return V(),F(p,{title:"查看物流",visible:i.dialogVisible,onClose:d.dialogFormVisible,"close-on-click-modal":!1,"close-on-press-escape":!1,width:"900px"},{default:L((()=>[S(c,{reverse:i.reverse},{default:L((()=>[(V(!0),U(B,null,I(i.activities,((e,a)=>(V(),F(n,{key:a,color:0==a?"#2ECC40":"",timestamp:e.time},{default:L((()=>[E(N(e.context),1)])),_:2},1032,["color","timestamp"])))),128))])),_:1},8,["reverse"])])),_:1},8,["visible","onClose"])}]]),{token:O}=z(),Q={components:{Cancel:A,Logistics:G},data:()=>({activeName:"all",loading:!0,tableData:[],pageSize:20,totalDataNumber:0,curPage:1,searchForm:{search:"",order_no:"",style_id:"",store_id:"",create_time:"",token:O},exStyle:[],shopList:[],create_time:"",order_count:{payment:0,delivery:0,received:0,cancel:0},isLogistics:!1,logisticsData:{},dialogBatchDelivery:!1,open_edit:!1,order_no:0}),created(){this.getData()},methods:{arraySpanMethod(e){if(e.rowIndex%2==0&&0===e.columnIndex)return[1,8]},handleCurrentChange(e){this.curPage=e,this.getData()},handleSizeChange(e){this.curPage=1,this.pageSize=e,this.getData()},handleClick(e,a){this.curPage=1,this.getData()},getData(){let e=this,a=this.searchForm;a.dataType=e.activeName,a.page=e.curPage,a.list_rows=e.pageSize,e.loading=!0,C(a).then((a=>{let t=[];for(let e=0;e<a.data.list.data.length;e++){let l=a.data.list.data[e],s={order_no:l.order_no,create_time:l.create_time,order_source:l.order_source,order_source_text:l.order_source_text,order_status:l.order_status.value,is_top_row:!0};t.push(s),t.push(l)}e.tableData.data=t,e.totalDataNumber=a.data.list.total,e.exStyle=a.data.ex_style,e.shopList=a.data.shop_list,e.order_count=a.data.order_count.order_count,e.loading=!1})).catch((e=>{}))},cancelClick(e){this.order_no=e.order_no,this.open_edit=!0},closeDialogFunc(e,a){"edit"==a&&(this.open_edit=e.openDialog,"success"==e.type&&this.getData())},addClick(e){let a=e.order_id;this.$router.push({path:"/order/order/detail",query:{order_id:a}})},getLogistics(e){let a=this,t={order_id:e.order_id};a.loading=!0,x(t).then((e=>{a.loading=!1,a.logisticsData=e.data.express.list,a.openLogistics()})).catch((e=>{a.loading=!1}))},openLogistics(){this.isLogistics=!0},closeLogistics(){this.isLogistics=!1},onSubmit(){this.curPage=1,this.tableData=[],this.getData()},onExport:function(){let e=this.searchForm;this.$filter.onExportFunc("/index.php/supplier/order.operate/export",e)},showBatchDelivery(){this.dialogBatchDelivery=!0},gotoExpress(){this.$router.push("/setting/express/index")},wxdeliveryClick(e){let a=this,t=e.order_id;l.confirm("确定发货吗?","提示",{type:"warning"}).then((()=>{D({order_id:t}).then((e=>{a.loading=!1,s({message:"恭喜你，操作成功",type:"success"}),a.getData()})).catch((e=>{a.loading=!1}))})).catch((()=>{s({type:"info",message:"已取消发货"})}))},onBeforeUploadImage(e){const a="xlsx"===e.name.substring(e.name.lastIndexOf(".")+1),t=e.size/1024/1024<10;return a||s.error("上传文件只能是excel格式!"),t||s.error("上传文件大小不能超过 10MB!"),a&&t},UploadImage(e){let a=this;const t=r.service({lock:!0,text:"正在处理,请等待",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),l=new FormData;l.append("iFile",e.file),w(l).then((e=>{t.close(),a.dialogBatchDelivery=!1,s({message:e.msg,type:"warning"})})).catch((a=>{t.close(),s({message:"本次处理失败",type:"warning"}),e.onError()}))}}},W={class:"user"},X={class:"common-seach-wrap"},H={class:"block"},J=M("span",{class:"demonstration"},null,-1),K={class:"product-content"},R={class:"table-wrap"},Z=M("span",null,"全部订单",-1),ee=M("span",null,"待评价",-1),ae=M("span",null,"已完成",-1),te={key:0,class:"order-code"},le={class:"c_main"},se={class:"pl16"},re={key:0,class:"pl16"},oe={class:"pic"},ie={alt:""},de={class:"info"},ne={class:"name gray3 product-name"},ce={key:0,class:"gray9"},pe={key:1,class:"orange"},ue={class:"d-c-c d-c"},me={class:"orange"},_e={class:"gray3"},ye={key:0},ge={key:0,class:"orange"},he={key:1,class:"orange"},ve={key:2,class:"orange"},fe={key:0},ke={class:"gray9"},be={key:0},Ce={key:0,class:"gray9"},xe={key:0},De={class:"green"},we={key:0},je={key:0},ze={key:1,class:"green"},Ve={key:0},Fe={class:"pagination"},Le=M("div",null,"1、先按未发货条件筛选后，导出订单",-1),Se=M("div",null,"2、在导出excel中填写物流公司、物流单号，然后点批量发货导入填好的excel文件",-1),Ue={style:{"padding-top":"20px","padding-bottom":"20px","text-align":"center"}};const Be=j(Q,[["render",function(e,a,l,s,r,C){const x=o,D=i,w=d,j=n,z=c,A=p,G=u,O=m,Q=_,Be=y,Ie=g,Ee=h,Ne=v,Pe=P("Logistics"),qe=f,Me=k,Ye=t,$e=P("Cancel"),Te=q("auth"),Ae=q("img-url"),Ge=b;return V(),U("div",W,[M("div",X,[S(G,{size:"small",inline:!0,model:r.searchForm,class:"demo-form-inline"},{default:L((()=>[S(D,{label:"会员信息"},{default:L((()=>[S(x,{modelValue:r.searchForm.search,"onUpdate:modelValue":a[0]||(a[0]=e=>r.searchForm.search=e),placeholder:"请输入昵称|手机号|ID"},null,8,["modelValue"])])),_:1}),S(D,{label:"订单号"},{default:L((()=>[S(x,{size:"small",modelValue:r.searchForm.order_no,"onUpdate:modelValue":a[1]||(a[1]=e=>r.searchForm.order_no=e),placeholder:"请输入订单号"},null,8,["modelValue"])])),_:1}),S(D,{label:"配送方式"},{default:L((()=>[S(j,{size:"small",modelValue:r.searchForm.style_id,"onUpdate:modelValue":a[2]||(a[2]=e=>r.searchForm.style_id=e),placeholder:"请选择"},{default:L((()=>[S(w,{label:"全部",value:""}),(V(!0),U(B,null,I(r.exStyle,((e,a)=>(V(),F(w,{key:a,label:e.name,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),S(D,{label:"门店地址"},{default:L((()=>[S(j,{size:"small",modelValue:r.searchForm.store_id,"onUpdate:modelValue":a[3]||(a[3]=e=>r.searchForm.store_id=e),placeholder:"请选择"},{default:L((()=>[S(w,{label:"全部",value:""}),(V(!0),U(B,null,I(r.shopList,((e,a)=>(V(),F(w,{key:a,label:e.store_name,value:e.store_id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),S(D,{label:"起始时间"},{default:L((()=>[M("div",H,[J,S(z,{size:"small",modelValue:r.searchForm.create_time,"onUpdate:modelValue":a[4]||(a[4]=e=>r.searchForm.create_time=e),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])])])),_:1}),S(D,null,{default:L((()=>[S(A,{size:"small",type:"primary",icon:"Search",onClick:C.onSubmit},{default:L((()=>[E("查询")])),_:1},8,["onClick"])])),_:1}),S(D,null,{default:L((()=>[Y((V(),F(A,{size:"small",type:"success",onClick:C.onExport},{default:L((()=>[E("导出")])),_:1},8,["onClick"])),[[Te,"/order/operate/export"]])])),_:1}),S(D,{style:{float:"right"}},{default:L((()=>[Y((V(),F(A,{size:"small",type:"warning",onClick:C.showBatchDelivery},{default:L((()=>[E("批量发货")])),_:1},8,["onClick"])),[[Te,"/order/operate/batchDelivery"]])])),_:1})])),_:1},8,["model"])]),M("div",K,[M("div",R,[S(Be,{modelValue:r.activeName,"onUpdate:modelValue":a[5]||(a[5]=e=>r.activeName=e),onTabChange:C.handleClick},{default:L((()=>[S(O,{label:"全部订单",name:"all"},{label:L((()=>[Z])),_:1}),S(O,{label:"未付款",name:"payment"},{label:L((()=>[M("span",null,[E("未付款 "),S(Q,{size:"small"},{default:L((()=>[E(N(r.order_count.payment),1)])),_:1})])])),_:1}),S(O,{label:"待发货",name:"delivery"},{label:L((()=>[M("span",null,[E("待发货 "),S(Q,{size:"small"},{default:L((()=>[E(N(r.order_count.delivery),1)])),_:1})])])),_:1}),S(O,{label:"待收货",name:"received"},{label:L((()=>[M("span",null,[E("待收货 "),S(Q,{size:"small"},{default:L((()=>[E(N(r.order_count.received),1)])),_:1})])])),_:1}),S(O,{label:"待取消",name:"cancel"},{label:L((()=>[M("span",null,[E("待取消 "),S(Q,{size:"small"},{default:L((()=>[E(N(r.order_count.cancel),1)])),_:1})])])),_:1}),S(O,{label:"待评价",name:"comment"},{label:L((()=>[ee])),_:1}),S(O,{label:"已完成",name:"complete"},{label:L((()=>[ae])),_:1})])),_:1},8,["modelValue","onTabChange"]),Y((V(),F(Ee,{size:"small",data:r.tableData.data,"span-method":C.arraySpanMethod,border:"",style:{width:"100%"}},{default:L((()=>[S(Ie,{prop:"order_no",label:"订单信息",width:"400"},{default:L((({row:e})=>[e.is_top_row?(V(),U("div",te,[M("span",{class:$(["state-text",{"state-text-red":10!=e.order_source}])},N(e.order_source_text),3),M("span",le," 订单号："+N(e.order_no),1),M("span",se,"下单时间："+N(e.create_time),1),21==e.order_status?(V(),U("span",re,[S(Q,{effect:"dark",size:"mini"},{default:L((()=>[E("取消申请中")])),_:1})])):T("",!0)])):(V(!0),U(B,{key:1},I(e.product,((e,a)=>(V(),U("div",{class:"product-info",key:a},[M("div",oe,[Y(M("img",ie,null,512),[[Ae,e.image.file_path]])]),M("div",de,[M("div",ne,[M("span",null,N(e.product_name),1)]),e.product_attr?(V(),U("div",ce,N(e.product_attr),1)):T("",!0),e.refund?(V(),U("div",pe,N(e.refund.type.text)+"-"+N(e.refund.status.text),1)):T("",!0)]),M("div",ue,[M("div",me,"￥ "+N(e.product_price),1),M("div",_e,"x"+N(e.total_num),1)])])))),128))])),_:1}),S(Ie,{prop:"pay_price",label:"实付款"},{default:L((({row:e})=>[e.is_top_row?T("",!0):(V(),U("div",ye,[70!=e.order_source?(V(),U("div",ge,N(e.pay_price),1)):T("",!0),70==e.order_source?(V(),U("p",he,"定金："+N(e.advance.pay_price),1)):T("",!0),70==e.order_source?(V(),U("p",ve,"尾款："+N(e.pay_price),1)):T("",!0)]))])),_:1}),S(Ie,{prop:"",label:"买家"},{default:L((({row:e})=>[e.is_top_row?T("",!0):(V(),U("div",fe,[M("div",null,N(e.user.nickName),1),M("div",ke,"ID：("+N(e.user.user_id)+")",1)]))])),_:1}),S(Ie,{prop:"state_text",label:"交易状态"},{default:L((({row:e})=>[e.is_top_row?T("",!0):(V(),U("span",be,N(e.state_text),1))])),_:1}),S(Ie,{prop:"pay_type.text",label:"支付方式"},{default:L((({row:e})=>[e.is_top_row?T("",!0):(V(),U("span",Ce,N(e.pay_type.text),1))])),_:1}),S(Ie,{prop:"delivery_type.text",label:"配送方式"},{default:L((({row:e})=>[e.is_top_row?T("",!0):(V(),U("div",xe,[M("span",De,N(e.delivery_type.text),1),30==e.delivery_type.value?(V(),U("span",we,"手机号:"+N(e.user.mobile),1)):T("",!0)]))])),_:1}),S(Ie,{label:"结算状态"},{default:L((({row:e})=>[0==e.is_settled?(V(),U("span",je,"未结算")):T("",!0),1==e.is_settled?(V(),U("span",ze,"已结算")):T("",!0)])),_:1}),S(Ie,{fixed:"right",label:"操作",width:"210"},{default:L((({row:e})=>[e.is_top_row?T("",!0):(V(),U("div",Ve,[Y((V(),F(A,{onClick:a=>C.addClick(e),link:"",type:"primary",size:"small"},{default:L((()=>[E("订单详情 ")])),_:2},1032,["onClick"])),[[Te,"/order/order/detail"]]),10==e.delivery_type.value&&20==e.delivery_status.value?Y((V(),F(A,{key:0,onClick:a=>C.getLogistics(e),link:"",type:"primary",size:"small"},{default:L((()=>[E("查看物流 ")])),_:2},1032,["onClick"])),[[Te,"/order/order/detail"]]):T("",!0),20==e.pay_status.value&&10==e.delivery_status.value&&20!=e.order_status.value&&21!=e.order_status.value&&10==e.delivery_type.value&&10!=e.assemble_status&&30!=e.assemble_status?Y((V(),F(A,{key:1,onClick:a=>C.addClick(e),link:"",type:"primary",size:"small"},{default:L((()=>[E(" 去发货 ")])),_:2},1032,["onClick"])),[[Te,"/order/order/delivery"]]):T("",!0),20==e.pay_status.value&&10==e.delivery_status.value&&20!=e.order_status.value&&21!=e.order_status.value&&20==e.delivery_type.value?Y((V(),F(A,{key:2,onClick:a=>C.addClick(e),link:"",type:"primary",size:"small"},{default:L((()=>[E(" 去核销 ")])),_:2},1032,["onClick"])),[[Te,"/order/operate/extract"]]):T("",!0),20==e.pay_status.value&&10==e.delivery_status.value&&20!=e.order_status.value&&21!=e.order_status.value&&30==e.delivery_type.value&&10!=e.assemble_status&&30!=e.assemble_status?Y((V(),F(A,{key:3,onClick:a=>C.addClick(e),link:"",type:"primary",size:"small"},{default:L((()=>[E(" 去发货 ")])),_:2},1032,["onClick"])),[[Te,"/order/order/delivery"]]):T("",!0),20==e.pay_status.value&&10==e.delivery_status.value&&10==e.order_status.value?Y((V(),F(A,{key:4,onClick:a=>C.cancelClick(e),link:"",type:"primary",size:"small"},{default:L((()=>[E(" 取消订单 ")])),_:2},1032,["onClick"])),[[Te,"/order/order/orderCancel"]]):T("",!0),21==e.order_status.value?Y((V(),F(A,{key:5,onClick:a=>C.addClick(e),link:"",type:"primary",size:"small"},{default:L((()=>[E("去审核")])),_:2},1032,["onClick"])),[[Te,"/order/operate/confirmCancel"]]):T("",!0),20==e.pay_type.value&&20==e.pay_status.value&&20==e.delivery_status.value&&10==e.order_status.value&&10==e.wx_delivery_status&&"wx"==e.pay_source?Y((V(),F(A,{key:6,onClick:a=>C.wxdeliveryClick(e),link:"",type:"primary",size:"small"},{default:L((()=>[E("小程序发货")])),_:2},1032,["onClick"])),[[Te,"/order/order/wxDelivery"]]):T("",!0)]))])),_:1})])),_:1},8,["data","span-method"])),[[Ge,r.loading]])]),M("div",Fe,[S(Ne,{onSizeChange:C.handleSizeChange,onCurrentChange:C.handleCurrentChange,background:"","current-page":r.curPage,"page-size":r.pageSize,layout:"total, prev, pager, next, jumper",total:r.totalDataNumber},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])]),S(Pe,{logisticsData:r.logisticsData,isLogistics:r.isLogistics,onCloseDialog:C.closeLogistics},null,8,["logisticsData","isLogistics","onCloseDialog"]),S(Ye,{title:"批量发货说明",modelValue:r.dialogBatchDelivery,"onUpdate:modelValue":a[7]||(a[7]=e=>r.dialogBatchDelivery=e),width:"30%"},{default:L((()=>[Le,Se,M("div",null,[E("3、请检查物流公司是否已经添加到系统，"),S(qe,{type:"primary",underline:!1,onClick:a[6]||(a[6]=e=>C.gotoExpress())},{default:L((()=>[E("查看")])),_:1})]),M("div",Ue,[S(Me,{class:"avatar-uploader",ref:"upload",action:"string",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","before-upload":C.onBeforeUploadImage,"http-request":C.UploadImage,"show-file-list":!1},{default:L((()=>[S(A,{size:"small",icon:"Upload",type:"primary"},{default:L((()=>[E("上传发货表格")])),_:1})])),_:1},8,["before-upload","http-request"])])])),_:1},8,["modelValue"]),r.open_edit?(V(),F($e,{key:0,open_edit:r.open_edit,order_no:r.order_no,onCloseDialog:a[8]||(a[8]=e=>C.closeDialogFunc(e,"edit"))},null,8,["open_edit","order_no"])):T("",!0)])}]]);export{Be as default};
