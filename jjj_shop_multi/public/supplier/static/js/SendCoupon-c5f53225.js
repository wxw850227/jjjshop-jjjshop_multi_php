import{i as e,f as a,j as s,k as t,l,v as o,E as i,s as n,e as r,n as d,o as p,d as u,c as m}from"./element-plus-1d28f1d0.js";import{b as c,t as g,S as h}from"./coupon-eef4d6a0.js";import{_}from"./index-3957abef.js";import{o as b,T as f,S as C,a as y,$ as j,P as v,c as k,X as V,W as w,Q as z,a9 as D,Y as S,bh as x,bf as U}from"./@vue-fcfaff04.js";import{_ as G}from"./GetUser-3d7de25d.js";import"./lodash-es-493ac664.js";import"./async-validator-cf877c1f.js";import"./@vueuse-28c84072.js";import"./dayjs-3f6c138b.js";import"./call-bind-a6dd5c06.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-6c014c7f.js";import"./escape-html-d3e23fdb.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./vue-router-0cda4647.js";import"./pinia-234ab43f.js";import"./axios-63583d02.js";import"./vue-ueditor-wrap-33bac798.js";import"./qs-edfbe083.js";import"./side-channel-6da5de8a.js";import"./object-inspect-66d569d0.js";import"./data-72b673e3.js";const L={class:"product-content"},P={class:"table-wrap"},F={key:0},T={key:1},q={class:"pagination"};const N=_({data:()=>({loading:!0,curPage:1,pageSize:20,totalDataNumber:0,formInline:{name:""},tableData:[],formRules:{name:[{required:!0,message:"请输入等级名称",trigger:"blur"},{min:3,max:5,message:"长度在 3 到 5 个字符",trigger:"blur"}]},multipleSelection:[],formLabelWidth:"120px",dialogVisible:!1}),props:["open_add","type"],created(){this.dialogVisible=this.open_add,this.getTableList()},methods:{handleCurrentChange(e){this.curPage=e,this.getTableList()},handleSizeChange(e){this.curPage=1,this.pageSize=e,this.getTableList()},getTableList(){let e=this,a={};a.page=e.curPage,a.list_rows=e.pageSize,e.type&&(a.shop_supplier_id=0),c(a).then((a=>{e.loading=!1,e.tableData=a.data.list.data,e.totalDataNumber=a.data.list.total,e.gradeList=a.data.grade})).catch((e=>{}))},selectUser(e){let a=e;this.$emit("closeDialog",{type:"success",openDialog:!1,params:a})},dialogFormVisible(e){e?this.$emit("closeDialog",{type:"success",openDialog:!1}):this.$emit("closeDialog",{type:"error",openDialog:!1})}}},[["render",function(i,n,r,d,p,u){const m=e,c=a,g=s,h=t,_=l,z=o;return b(),f(_,{title:"选择优惠券",visible:p.dialogVisible,onClose:u.dialogFormVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},{default:C((()=>[y("div",L,[y("div",P,[j((b(),f(g,{data:p.tableData,border:"",style:{width:"100%"},onCurrentChange:u.handleCurrentChange},{default:C((()=>[v(m,{prop:"name",label:"名称"}),v(m,{prop:"min_price",label:"最低消费"}),v(m,{prop:"total_num",label:"数量"},{default:C((e=>[e.row.total_num>0?(b(),k("span",F,V(e.row.total_num),1)):(b(),k("span",T,"无限制"))])),_:1}),v(m,{label:"操作",width:"80"},{default:C((e=>[v(c,{type:"primary",size:"mini",onClick:a=>u.selectUser(e.row)},{default:C((()=>[w("选择")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","onCurrentChange"])),[[z,p.loading]])]),y("div",q,[v(h,{onSizeChange:u.handleSizeChange,onCurrentChange:u.handleCurrentChange,background:"","current-page":p.curPage,"page-sizes":[2,10,20,50,100],"page-size":p.pageSize,layout:"total, prev, pager, next, jumper",total:p.totalDataNumber},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])])])),_:1},8,["visible","onClose"])}]]),$={components:{GetUser:G,GetCoupon:N},data:()=>({loading:!1,form:{send_type:"1",coupon_id:0,user_level:"",user_ids:"",name:""},grade:{},open_getuser:!1,select_list:[],open_coupon:!1}),created(){this.getGradeList()},methods:{getGradeList(){let e=this;g({}).then((a=>{e.grade=a.data.list})).catch((e=>{}))},openGetuser(){this.open_getuser=!0},closeGetuserFunc(e){"error"!=e.type&&(this.select_list=this.select_list.concat(e.params)),this.open_getuser=!1},openConpon(){this.open_coupon=!0},closeCouponFunc(e){this.open_coupon=!1,"error"!=e.type&&(this.form.name=e.params.name,this.form.coupon_id=e.params.coupon_id)},onSubmit(){let e=this,a=e.form;if(3==a.send_type){let s=[];e.select_list.forEach((e=>{s.push(e.user_id)})),a.user_ids=s.join(",")}h(a).then((a=>{e.loading=!1,i({message:"发送成功",type:"success"})})).catch((a=>{e.loading=!1}))}}},E=e=>(x("data-v-3b0d1cbd"),e=e(),U(),e),I={class:"user"},W=E((()=>y("div",{class:"common-form"},"发送优惠券",-1))),Q={class:"product-content"},R={class:"d-s-s d-c"},X={class:"d-s-s select-user"},Y=["src"],A={class:"lh18 ww100 text-ellipsis"},B=E((()=>y("p",null,"注： 发送的优惠券会员领取已达到限制数量，将不再发送给该会员。",-1))),H={class:"common-button-wrapper"};const J=_($,[["render",function(e,s,t,l,o,i){const c=n,g=r,h=d,_=p,j=a,x=u,U=m,L=G,P=N;return b(),k("div",I,[W,y("div",Q,[v(U,{ref:"form",size:"small",model:o.form,"label-width":"150px"},{default:C((()=>[v(g,{label:"发送对象"},{default:C((()=>[v(c,{modelValue:o.form.send_type,"onUpdate:modelValue":s[0]||(s[0]=e=>o.form.send_type=e),label:"1"},{default:C((()=>[w("全站会员")])),_:1},8,["modelValue"]),v(c,{modelValue:o.form.send_type,"onUpdate:modelValue":s[1]||(s[1]=e=>o.form.send_type=e),label:"2"},{default:C((()=>[w("会员等级")])),_:1},8,["modelValue"]),v(c,{modelValue:o.form.send_type,"onUpdate:modelValue":s[2]||(s[2]=e=>o.form.send_type=e),label:"3"},{default:C((()=>[w("指定会员")])),_:1},8,["modelValue"])])),_:1}),2==o.form.send_type?(b(),f(g,{key:0,label:"选择会员等级"},{default:C((()=>[v(_,{modelValue:o.form.user_level,"onUpdate:modelValue":s[3]||(s[3]=e=>o.form.user_level=e),placeholder:"请选择"},{default:C((()=>[(b(!0),k(z,null,D(o.grade,((e,a)=>(b(),f(h,{key:a,label:e.name,value:e.grade_id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):S("",!0),3==o.form.send_type?(b(),f(g,{key:1,label:"选择会员"},{default:C((()=>[y("div",R,[v(j,{onClick:i.openGetuser,icon:"Plus"},{default:C((()=>[w("选择会员")])),_:1},8,["onClick"]),y("ul",X,[(b(!0),k(z,null,D(o.select_list,((e,a)=>(b(),k("li",{class:"mr10 d-c-c d-c p-10-0",key:a},[y("img",{src:e.avatarUrl,class:"radius",width:"30",height:"30"},null,8,Y),y("p",A,V(e.nickName),1)])))),128))])])])),_:1})):S("",!0),v(g,{label:"选择优惠券 ",prop:"name",rules:[{required:!0,message:" "}]},{default:C((()=>[v(x,{type:"text",modelValue:o.form.name,"onUpdate:modelValue":s[4]||(s[4]=e=>o.form.name=e),placeholder:"请选择优惠券",class:"max-w460",disabled:!0},null,8,["modelValue"]),v(j,{onClick:i.openConpon,icon:"Plus"},{default:C((()=>[w("选择优惠券")])),_:1},8,["onClick"]),B])),_:1}),y("div",H,[v(j,{size:"small",type:"primary",onClick:i.onSubmit,loading:o.loading},{default:C((()=>[w("提交")])),_:1},8,["onClick","loading"])])])),_:1},8,["model"])]),v(L,{is_open:o.open_getuser,onClose:i.closeGetuserFunc},null,8,["is_open","onClose"]),o.open_coupon?(b(),f(P,{key:0,open_add:o.open_coupon,onCloseDialog:s[5]||(s[5]=e=>i.closeCouponFunc(e,"add"))},null,8,["open_add"])):S("",!0)])}],["__scopeId","data-v-3b0d1cbd"]]);export{J as default};
