import{_ as e,ae as a,A as t,z as s,af as o,B as n,o as i,c as l,h as c,am as u,N as d,w as p,n as f,d as m,e as r,t as g,f as h,k as _,i as b,I,j as w,a9 as k,l as y}from"./index-73db7405.js";import{P as N}from"./uni-popup.a3ada4d4.js";const P=e({components:{Upload:e({data:()=>({imageList:[]}),onLoad(){},mounted(){this.chooseImageFunc()},methods:{chooseImageFunc(){let e=this;a({count:1,sizeType:["original","compressed"],sourceType:["album","camera "],success:function(a){e.uploadFile(a.tempFilePaths)},fail:function(a){e.$emit("getImgs",null),console.log("上传失败")},complete:function(a){e.$emit("getImgs",null),console.log("上传结束")}})},uploadFile:function(e){let a=this,i=0,l=e.length,c={token:t("token"),app_id:a.getAppId()};s({title:"图片上传中"}),e.forEach((function(e,t){o({url:a.websiteUrl+"/index.php?s=/api/file.upload/image",filePath:e,name:"iFile",formData:c,success:function(e){let t="object"==typeof e.data?e.data:JSON.parse(e.data);1===t.code?a.imageList.push(t.data):a.showError(t.msg)},complete:function(){i++,l===i&&(n(),a.$emit("getImgs",a.imageList))}})}))}}},[["render",function(e,a,t,s,o,n){const u=c;return i(),l(u)}]]),Popup:N},data:()=>({userInfo:{},isUpload:!1,isPopup:!1,newName:"",type:"",version_no:"",imageList:[]}),onShow(){this.getData()},methods:{onChooseAvatar(e){console.log(e),this.uploadFile([e.detail.avatarUrl])},getData(){let e=this;s({title:"加载中"}),e._get("user.index/setting",{},(function(a){e.userInfo=a.data.userInfo,n()}))},gotoBind(){this.gotoPage("/pages/user/modify-phone/modify-phone")},logout(){u("token"),u("user_id"),this.gotoPage("/pages/index/index")},changeName(e){let a=this;"mobile"==e&&(a.oldmobile=a.userInfo.mobile),a.type=e,a.newName=a.userInfo[e],a.isPopup=!0},hidePopupFunc(){this.newName="",this.isPopup=!1},changeinput(e){this.newName=e.detail.value},clearName(){this.newName=""},subName(e){let a=this;a.loading||(a.newName=e.detail.value.newName,a.userInfo[a.type]=this.newName,a.update())},changeAvatarUrl(){this.isUpload=!0},uploadFile:function(e){let a=this,i=0,l=e.length,c={token:t("token"),app_id:a.getAppId()};s({title:"图片上传中"}),e.forEach((function(e,t){o({url:a.websiteUrl+"/index.php?s=/api/file.upload/image",filePath:e,name:"iFile",formData:c,success:function(e){let t="object"==typeof e.data?e.data:JSON.parse(e.data);1===t.code?a.imageList.push(t.data):a.showError(t.msg)},complete:function(){i++,l===i&&(n(),a.getImgsFunc(a.imageList))}})}))},getImgsFunc(e){if(e&&void 0!==e){let a=this;a.userInfo.avatarUrl=e[0].file_path,a.update(),a.isUpload=!1}},update(){let e=this;if(e.loading)return;s({title:"加载中"});let a=e.userInfo;e.loading=!0,e._post("user.user/updateInfo",a,(function(a){e.showSuccess("修改成功",(function(){e.loading=!1,e.isPopup=!1,n(),e.getData()}),(function(a){n(),e.loading=!1,e.isPopup=!1}))}))},deleteAccount(){let e=this;d({title:"提示",content:"是否确认删除账号？删除后您将无法用此账号登录，此账户下的数据也将删除",success:function(a){a.confirm&&e._post("user.user/deleteAccount",{},(a=>{e.showSuccess("删除成功",(()=>{u("token"),u("user_id"),e.gotoPage("/pages/index/index")}))}),!1,(()=>{n()}))}})}}},[["render",function(e,a,t,s,o,n){const u=_,d=b,N=c,P=I,v=w,F=k,U=y("Popup"),x=y("Upload");return i(),l(N,{class:f(["address-form",e.theme()||""]),"data-theme":e.theme()},{default:p((()=>[m(N,{class:"bg-white p-0-30 f30"},{default:p((()=>[m(N,{class:"d-b-c border-b info-item avatar"},{default:p((()=>[m(u,{class:"key-name"},{default:p((()=>[r("头像")])),_:1}),m(N,{class:"d-e-c",onClick:n.changeAvatarUrl},{default:p((()=>[m(N,{class:"info-image"},{default:p((()=>[m(d,{src:o.userInfo.avatarUrl||"/static/default.png",mode:""},null,8,["src"])])),_:1}),m(u,{class:"icon iconfont icon-jiantou"})])),_:1},8,["onClick"])])),_:1}),m(N,{class:"d-b-c p-30-0 border-b"},{default:p((()=>[m(u,{class:"key-name"},{default:p((()=>[r("会员ID")])),_:1}),m(N,{class:"d-e-c"},{default:p((()=>[m(u,{class:"mr20"},{default:p((()=>[r(g(o.userInfo.user_id),1)])),_:1})])),_:1})])),_:1}),m(N,{class:"d-b-c p-30-0 border-b"},{default:p((()=>[m(u,{class:"key-name"},{default:p((()=>[r("昵称")])),_:1}),m(N,{class:"d-e-c",onClick:a[0]||(a[0]=e=>n.changeName("nickName"))},{default:p((()=>[m(u,{class:"mr20"},{default:p((()=>[r(g(o.userInfo.nickName),1)])),_:1}),m(u,{class:"icon iconfont icon-jiantou"})])),_:1})])),_:1}),m(N,{class:"d-b-c p-30-0"},{default:p((()=>[m(u,{class:"key-name"},{default:p((()=>[r("手机号码")])),_:1}),o.userInfo.mobile?(i(),l(N,{key:0,class:"d-e-c"},{default:p((()=>[m(u,{class:"mr20"},{default:p((()=>[r(g(o.userInfo.mobile),1)])),_:1})])),_:1})):h("",!0),o.userInfo.mobile?h("",!0):(i(),l(N,{key:1,class:"d-e-c",onClick:n.gotoBind},{default:p((()=>[m(u,{class:"mr20"},{default:p((()=>[r("未绑定")])),_:1}),m(u,{class:"iconfont icon-jiantou"})])),_:1},8,["onClick"]))])),_:1}),m(N,{class:"setup-btn",onClick:a[1]||(a[1]=e=>n.logout())},{default:p((()=>[r("退出登录")])),_:1})])),_:1}),m(U,{show:o.isPopup,type:"bottom",width:750,padding:0,onHidePopup:n.hidePopupFunc},{default:p((()=>[m(F,{onSubmit:n.subName,class:"ww100"},{default:p((()=>[m(N,{class:"d-s-s d-c p20 mpservice-wrap"},{default:p((()=>[m(N,{class:"tc f32 fb ww100"},{default:p((()=>[r("修改")])),_:1}),"mobile"==o.type||"nickName"==o.type||"user_name"==o.type||"email"==o.type||"idcard"==o.type?(i(),l(N,{key:0,class:"pop-input d-b-c"},{default:p((()=>[m(P,{type:"text",name:"newName",class:"flex-1",placeholder:"请输入",value:o.newName,onInput:n.changeinput},null,8,["value","onInput"]),m(N,{class:"icon-guanbi icon iconfont",onClick:n.clearName},null,8,["onClick"])])),_:1})):h("",!0),m(N,{class:"d-a-c ww100"},{default:p((()=>[m(v,{class:"btn-gray-border",onClick:n.hidePopupFunc},{default:p((()=>[r("取消")])),_:1},8,["onClick"]),m(v,{class:"theme-btn","form-type":"submit"},{default:p((()=>[r("确认")])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1},8,["show","onHidePopup"]),o.isUpload?(i(),l(x,{key:0,onGetImgs:n.getImgsFunc},null,8,["onGetImgs"])):h("",!0)])),_:1},8,["data-theme","class"])}],["__scopeId","data-v-763f5959"]]);export{P as default};
