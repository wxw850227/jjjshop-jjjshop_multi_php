import{_ as e,N as t,z as a,B as s,a as l,J as o,K as d,o as i,c,w as r,n,h as u,d as _,e as p,g as f,r as y,F as m,u as h,k as g,i as v,S as k,l as b,R as w,t as C,f as T,j as D}from"./index-73db7405.js";import{P}from"./uni-popup.a3ada4d4.js";import{u as F}from"./uni-load-more.e615c410.js";import{p as x}from"./pay.2338ad0e.js";const O=e({components:{Popup:P,uniLoadMore:F},data:()=>({phoneHeight:0,scrollviewHigh:0,state_active:0,topRefresh:!1,listData:[],dataType:"all",isPayPopup:!1,pay_type:20,order_id:0,last_page:0,page:1,list_rows:10,no_more:!1,loading:!0,isCodeImg:!1,codeImg:"",showAlipay:!1,isfirst:!1,mch_id:""}),computed:{loadingType(){return this.loading?1:0!=this.listData.length&&this.no_more?2:0}},onLoad(e){void 0!==e.dataType&&(this.dataType=e.dataType),"payment"==this.dataType?this.state_active=1:"received"==this.dataType?this.state_active=3:"comment"==this.dataType?this.state_active=4:"delivery"==this.dataType&&(this.state_active=2)},mounted(){this.init(),this.initData(),this.getData()},onShow(){this.isfirst&&(this.initData(),this.getData())},methods:{initData(){let e=this;e.page=1,e.listData=[],e.no_more=!1},cancelAdvance(e){let o=this,d=e;t({title:"提示",content:"您确定要取消吗?",success:function(e){e.confirm&&(a({title:"正在处理"}),o._get("plus.advance.Order/cancelFront",{order_id:d},(function(e){s(),l({title:"操作成功",duration:2e3,icon:"success"}),o.listData=[],o.getData()})))}})},depositPay(e){this.gotoPage("/pages/order/confirm-order?order_type=retainage&order_id="+e)},init(){let e=this;o({success(t){e.phoneHeight=t.windowHeight,d().in(e).select(".top-tabbar").boundingClientRect((t=>{let a=e.phoneHeight-t.height;e.scrollviewHigh=a})).exec()}})},stateFunc(e){console.log(11111,e);let t=this;if(t.state_active!=e){switch(t.page=1,t.loading=!0,t.state_active=e,e){case 0:t.listData=[],t.dataType="all";break;case 1:t.listData=[],t.dataType="payment";break;case 2:t.listData=[],t.dataType="delivery";break;case 3:t.listData=[],t.dataType="received";break;case 4:t.listData=[],t.dataType="comment"}t.getData()}},scrolltolowerFunc(){let e=this;e.no_more||(e.page++,e.page<=e.last_page?e.getData():e.no_more=!0)},getData(){let e=this;e.loading=!0;let t=e.dataType;e._get("user.order/lists",{dataType:t,page:e.page,pay_source:e.getPlatform(),list_rows:e.list_rows},(function(t){e.loading=!1,e.listData=e.listData.concat(t.data.list.data),e.last_page=t.data.list.last_page,e.mch_id=t.data.mch_id,t.data.list.last_page<=1?e.no_more=!0:e.no_more=!1,t.data.show_alipay&&(e.showAlipay=!0),e.isfirst=!0}))},gotoOrder(e){this.gotoPage("/pages/order/order-detail?order_id="+e)},hidePopupFunc(){this.isPayPopup=!1},toShop(e){this.gotoPage("/pages/shop/shop?shop_supplier_id="+e)},payTypeFunc(e){let t=this;t.isPayPopup=!1,a({title:"加载中"}),t._post("user.order/pay",{payType:e,order_id:t.order_id,pay_source:t.getPlatform()},(function(e){x(e,t)}))},onPayOrder(e){this.gotoPage("/pages/order/cashier?order_type=1&order_id="+e)},orderReceipt(e){let o=this;t({title:"提示",content:"您确定要收货吗?",success:function(t){t.confirm?(a({title:"正在处理"}),o._post("user.order/receipt",{order_id:e.order_id},(function(e){s(),l({title:e.msg,duration:2e3,icon:"success"}),o.listData=[],o.getData()}))):l({title:"取消收货",duration:1e3,icon:"none"})}})},countDown(e){let t=e-Date.now()/1e3,a=Math.floor(t/86400),s=t%86400,l=Math.floor(s/3600);s%=3600;let o=Math.floor(s/60),d=s%60;return a=this.convertTwo(a),l=this.convertTwo(l),o=this.convertTwo(o),d=this.convertTwo(d),parseInt(a)>0?parseInt(a)+"天 ":parseInt(l)+"时"+parseInt(o)+"分"+parseInt(d)+"秒"},cancelOrder(e){let o=this,d=e;t({title:"提示",content:"您确定要取消吗?",success:function(e){e.confirm&&(a({title:"正在处理"}),o._get("user.order/cancel",{order_id:d},(function(e){s(),l({title:"操作成功",duration:2e3,icon:"success"}),o.listData=[],o.getData()})))}})},gotoEvaluate(e){this.gotoPage("/pages/order/evaluate/evaluate?order_id="+e)},onQRCode(e){let t=this;a({title:"加载中"});let l=e,o=t.getPlatform();t._get("user.order/qrcode",{order_id:l,source:o},(function(e){s(),t.isCodeImg=!0,t.codeImg=e.data.qrcode}))},nowOverTime:e=>(new Date).getTime()>=new Date(1e3*e).getTime(),hideCodePopupFunc(){this.isCodeImg=!1},gotoAssembleShare(e){this.gotoPage("/pagesPlus/assemble/fight-group-detail/fight-group-detail?assemble_bill_id="+e)},wxOrder(e){let t=this;wx.openBusinessView&&wx.openBusinessView({businessType:"weappOrderConfirm",extraData:{merchant_id:t.mch_id,merchant_trade_no:e.trade_no,transaction_id:e.transaction_id},success(){t._post("user.order/receipt",{order_id:e.order_id},(function(e){l({title:e.msg,duration:2e3,icon:"success"}),t.listData=[],t.getData()}))},fail(){},complete(){}})}}},[["render",function(e,t,a,s,l,o){const d=u,P=g,F=v,x=k,O=D,I=b("uni-load-more"),R=b("Popup");return i(),c(d,{"data-theme":e.theme(),class:n(e.theme()||"")},{default:r((()=>[_(d,{class:"top-tabbar"},{default:r((()=>[_(d,{class:n(0==l.state_active?"tab-item active":"tab-item"),onClick:t[0]||(t[0]=e=>o.stateFunc(0))},{default:r((()=>[p("全部订单")])),_:1},8,["class"]),_(d,{class:n(1==l.state_active?"tab-item active":"tab-item"),onClick:t[1]||(t[1]=e=>o.stateFunc(1))},{default:r((()=>[p("待付款")])),_:1},8,["class"]),_(d,{class:n(2==l.state_active?"tab-item active":"tab-item"),onClick:t[2]||(t[2]=e=>o.stateFunc(2))},{default:r((()=>[p("待发货")])),_:1},8,["class"]),_(d,{class:n(3==l.state_active?"tab-item active":"tab-item"),onClick:t[3]||(t[3]=e=>o.stateFunc(3))},{default:r((()=>[p("待收货")])),_:1},8,["class"]),_(d,{class:n(4==l.state_active?"tab-item active":"tab-item"),onClick:t[4]||(t[4]=e=>o.stateFunc(4))},{default:r((()=>[p("待评价")])),_:1},8,["class"])])),_:1}),_(x,{"scroll-y":"true",class:"scroll-Y",style:h("height:"+l.scrollviewHigh+"px;"),"lower-threshold":"50",onScrolltolower:o.scrolltolowerFunc},{default:r((()=>[_(d,{class:n(l.topRefresh?"top-refresh open":"top-refresh")},{default:r((()=>[(i(),f(m,null,y(3,((e,t)=>_(d,{class:"circle",key:t}))),64))])),_:1},8,["class"]),_(d,{class:"order-list"},{default:r((()=>[(i(!0),f(m,null,y(l.listData,((t,a)=>(i(),c(d,{class:"item",key:a},{default:r((()=>[_(d,{class:"d-b-c pb38"},{default:r((()=>[_(d,{class:"item-dianpu",onClick:e=>o.toShop(t.supplier.shop_supplier_id)},{default:r((()=>[_(d,{class:"item-d-l mr10"},{default:r((()=>[w("i",{class:"icon iconfont icon-dianpu1"}),t.supplier?(i(),c(P,{key:0,class:"fb gray3 f32"},{default:r((()=>[p(C(t.supplier.name),1)])),_:2},1024)):T("",!0)])),_:2},1024),_(d,null,{default:r((()=>[w("i",{class:"icon iconfont icon-jiantou"})])),_:1})])),_:2},1032,["onClick"]),_(d,{class:"state"},{default:r((()=>[_(P,{class:"redF6"},{default:r((()=>[p(C(t.state_text),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),_(d,{class:"order-head d-b-c"},{default:r((()=>[_(d,null,{default:r((()=>[_(P,{class:"state-text"},{default:r((()=>[p(C(t.order_source_text),1)])),_:2},1024),_(P,{class:"shop-name flex-1 fb"},{default:r((()=>[p("订单号："+C(t.order_no),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),t.product.length>1?(i(),c(d,{key:0,class:"product-list pr",onClick:e=>o.gotoOrder(t.order_id)},{default:r((()=>[_(x,{"scroll-x":"true"},{default:r((()=>[_(d,{class:"list d-s-c pr100"},{default:r((()=>[(i(!0),f(m,null,y(t.product,((e,t)=>(i(),c(d,{class:"cover mr10",key:t},{default:r((()=>[_(F,{src:e.image.file_path,mode:"aspectFit"},null,8,["src"])])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024),_(d,{class:"total-count"},{default:r((()=>[_(d,{class:"left-shadow"}),_(d,{class:"price f24"},{default:r((()=>[p(" ¥ "),_(P,{class:"f32"},{default:r((()=>[p(C(t.pay_price),1)])),_:2},1024)])),_:2},1024),_(d,{class:"count"},{default:r((()=>[p("共"+C(t.product.length)+"件",1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])):(i(),c(d,{key:1,class:"one-product d-s-c",onClick:e=>o.gotoOrder(t.order_id)},{default:r((()=>[(i(!0),f(m,null,y(t.product,((e,t)=>(i(),c(d,{class:"cover",key:t},{default:r((()=>[_(F,{src:e.image.file_path,mode:"aspectFit"},null,8,["src"])])),_:2},1024)))),128)),_(d,{class:"pro-info flex-1"},{default:r((()=>[p(C(t.product[0].product_name),1)])),_:2},1024),_(d,{class:"total-count"},{default:r((()=>[_(d,{class:"left-shadow"}),70==t.order_source?(i(),c(d,{key:0,class:"price f24"},{default:r((()=>[p(" ¥"),_(P,{class:"f32"},{default:r((()=>[p(C((1*t.pay_price+1*t.advance.pay_price).toFixed(2)),1)])),_:2},1024)])),_:2},1024)):(i(),c(d,{key:1,class:"price f24"},{default:r((()=>[p(" ¥"),_(P,{class:"f32"},{default:r((()=>[p(C(t.pay_price),1)])),_:2},1024)])),_:2},1024)),_(d,{class:"count"},{default:r((()=>[p("共"+C(t.product[0].total_num)+"件",1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])),70==t.order_source?(i(),c(d,{key:2,class:"order-bts presale"},{default:r((()=>[_(d,{class:"d-b-c line-h-50 f24 gray9"},{default:r((()=>[_(d,null,{default:r((()=>[p("定金")])),_:1}),_(d,null,{default:r((()=>[_(P,null,{default:r((()=>[p(C(20==t.advance.pay_status.value?"已支付":"待支付"),1)])),_:2},1024),p("￥"+C(t.advance.pay_price),1)])),_:2},1024)])),_:2},1024),_(d,{class:"d-b-c line-h-50 f24 gray9"},{default:r((()=>[_(d,null,{default:r((()=>[p("尾款")])),_:1}),_(d,null,{default:r((()=>[_(P,null,{default:r((()=>[p(C(20==t.advance.pay_status.value&&20==t.pay_status.value?"已支付":"待支付"),1)])),_:2},1024),p("￥"+C(t.pay_price),1)])),_:2},1024)])),_:2},1024),10==t.order_status.value?(i(),f(m,{key:0},[t.advance&&20==t.advance.pay_status.value?(i(),c(d,{key:0,class:"d-e-c line-h-50 f24 gray9"},{default:r((()=>[o.nowOverTime(t.advance.end_time)&&t.pay_end_time_format?(i(),c(d,{key:0},{default:r((()=>[p(" 尾款支付截止时间:"),_(P,{class:"redF11"},{default:r((()=>[p(C(t.pay_end_time_format),1)])),_:2},1024)])),_:2},1024)):t.advance.end_time_text?(i(),c(d,{key:1},{default:r((()=>[p(" 尾款支付时间:"),_(P,{class:"redF11"},{default:r((()=>[p(C(t.advance.end_time_text),1)])),_:2},1024)])),_:2},1024)):T("",!0)])),_:2},1024)):T("",!0)],64)):T("",!0),w("template",null,[10==t.advance.pay_status.value&&10==t.advance.order_status?(i(),c(d,{key:0,class:"d-e-c line-h-50 f24 gray9"},{default:r((()=>[o.nowOverTime(t.advance.pay_end_time)||o.nowOverTime(t.advance.end_time)?T("",!0):(i(),c(d,{key:0},{default:r((()=>[p(" 定金支付截止时间: "),_(P,{class:"redF11"},{default:r((()=>[p(C(o.countDown(t.advance.pay_end_time)),1)])),_:2},1024)])),_:2},1024))])),_:2},1024)):T("",!0)]),21!=t.order_status.value?(i(),c(d,{key:1,class:"d-e-c"},{default:r((()=>[20==t.advance.pay_status.value&&10==t.pay_status.value?(i(),f(m,{key:0},[o.nowOverTime(t.advance.end_time)&&20!=t.order_status.value?(i(),c(d,{key:0,class:"d-e-c mt10"},{default:r((()=>[_(O,{class:"pay-btn theme-btn",onClick:a=>e.gotoPage("/pages/order/cashier?order_id="+t.order_id)},{default:r((()=>[p("支付尾款")])),_:2},1032,["onClick"])])),_:2},1024)):T("",!0)],64)):T("",!0),10==t.pay_status.value&&10==t.advance.order_status&&1==t.advance.money_return?(i(),c(d,{key:1,class:"d-e-c mt10"},{default:r((()=>[_(O,{class:"pay-btn theme-borderbtn",onClick:e=>o.cancelAdvance(t.advance.order_advance_id)},{default:r((()=>[p("取消定金")])),_:2},1032,["onClick"])])),_:2},1024)):T("",!0),10==t.order_status.value&&20==t.pay_status.value?(i(),f(m,{key:2},[10==t.delivery_status.value?(i(),c(O,{key:0,onClick:e=>o.cancelOrder(t.order_id),class:"theme-borderbtn"},{default:r((()=>[p("申请取消")])),_:2},1032,["onClick"])):T("",!0)],64)):T("",!0),10!=t.advance.pay_status.value||20==t.order_status.value||o.nowOverTime(t.advance.pay_end_time)?T("",!0):(i(),c(d,{key:3,class:"d-e-c mt10"},{default:r((()=>[_(O,{class:"pay-btn theme-btn",onClick:a=>e.gotoPage("/pages/order/cashier?order_type=50&order_id="+t.advance.order_advance_id)},{default:r((()=>[p("支付定金 ")])),_:2},1032,["onClick"])])),_:2},1024)),20==t.delivery_status.value&&10==t.receipt_status.value?(i(),c(d,{key:4,class:"d-e-c mt10"},{default:r((()=>[20==t.pay_type.value?(i(),c(O,{key:0,onClick:e=>o.wxOrder(t),class:"pay-btn theme-btn"},{default:r((()=>[p("确认收货")])),_:2},1032,["onClick"])):(i(),c(O,{key:1,onClick:e=>o.orderReceipt(t),class:"pay-btn theme-btn"},{default:r((()=>[p("确认收货")])),_:2},1032,["onClick"]))])),_:2},1024)):T("",!0),30==t.order_status.value&&0==t.is_comment?(i(),c(d,{key:5,class:"d-e-c mt10"},{default:r((()=>[_(O,{class:"pay-btn theme-btn",onClick:e=>o.gotoEvaluate(t.order_id)},{default:r((()=>[p("评价 ")])),_:2},1032,["onClick"])])),_:2},1024)):T("",!0)])),_:2},1024)):(i(),c(d,{key:2,class:"count d-e-c ww100 redF11"},{default:r((()=>[p("取消申请中")])),_:1}))])),_:2},1024)):(i(),c(d,{key:3,class:"order-bts"},{default:r((()=>[10==t.order_status.value?(i(),f(m,{key:0},[10==t.pay_status.value?(i(),c(O,{key:0,onClick:e=>o.cancelOrder(t.order_id),class:"theme-borderbtn"},{default:r((()=>[p("取消")])),_:2},1032,["onClick"])):T("",!0),20==t.pay_status.value&&10==t.delivery_status.value?(i(),c(O,{key:1,onClick:e=>o.cancelOrder(t.order_id),class:"theme-borderbtn"},{default:r((()=>[p("申请取消")])),_:2},1032,["onClick"])):T("",!0),20==t.pay_status.value&&20==t.delivery_type.value&&10==t.delivery_status.value?(i(),f(m,{key:2},[30==t.order_source&&20==t.assemble_status?(i(),c(O,{key:0,onClick:e=>o.onQRCode(t.order_id),class:"theme-borderbtn"},{default:r((()=>[p("核销码")])),_:2},1032,["onClick"])):T("",!0),30!=t.order_source?(i(),c(O,{key:1,onClick:e=>o.onQRCode(t.order_id),class:"theme-borderbtn"},{default:r((()=>[p("核销码")])),_:2},1032,["onClick"])):T("",!0)],64)):T("",!0),10==t.pay_status.value?(i(),c(O,{key:3,class:"theme-btn",onClick:e=>o.onPayOrder(t.order_id)},{default:r((()=>[p("付款")])),_:2},1032,["onClick"])):T("",!0),20==t.delivery_status.value&&10==t.receipt_status.value?(i(),f(m,{key:4},[20==t.pay_type.value?(i(),c(O,{key:0,class:"theme-btn",onClick:e=>o.wxOrder(t)},{default:r((()=>[p("确认收货")])),_:2},1032,["onClick"])):(i(),c(O,{key:1,class:"theme-btn",onClick:e=>o.orderReceipt(t)},{default:r((()=>[p("确认收货")])),_:2},1032,["onClick"]))],64)):T("",!0)],64)):T("",!0),21==t.order_status.value?(i(),c(P,{key:1,class:"count"},{default:r((()=>[p("取消申请中")])),_:1})):T("",!0),30==t.order_status.value&&0==t.is_comment?(i(),c(O,{key:2,class:"theme-btn",onClick:e=>o.gotoEvaluate(t.order_id)},{default:r((()=>[p("评价")])),_:2},1032,["onClick"])):T("",!0),10==t.assemble_status&&30==t.order_source?(i(),c(O,{key:3,class:"theme-btn",onClick:e=>o.gotoAssembleShare(t.product[0].bill_source_id)},{default:r((()=>[p("邀请好友拼单")])),_:2},1032,["onClick"])):T("",!0)])),_:2},1024))])),_:2},1024)))),128)),0!=l.listData.length||l.loading?(i(),c(I,{key:1,loadingType:o.loadingType},null,8,["loadingType"])):(i(),c(d,{key:0,class:"d-c-c p30"},{default:r((()=>[_(P,{class:"iconfont icon-wushuju"}),_(P,{class:"cont"},{default:r((()=>[p("亲，暂无相关记录哦")])),_:1})])),_:1}))])),_:1})])),_:1},8,["style","onScrolltolower"]),_(R,{show:l.isCodeImg,type:"middle",onHidePopup:o.hideCodePopupFunc},{default:r((()=>[_(d,{class:"ww100 p20 box-s-b"},{default:r((()=>[_(F,{class:"ww100",src:l.codeImg,mode:"widthFix"},null,8,["src"])])),_:1})])),_:1},8,["show","onHidePopup"])])),_:1},8,["data-theme","class"])}],["__scopeId","data-v-9d5f3185"]]);export{O as default};
