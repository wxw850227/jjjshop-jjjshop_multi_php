import{E as e,t as l,u as a,d as o,e as t,i as d,A as r,s,f as i,l as u,m as p,y as m,h as c,c as n,v as _}from"./element-plus-78c440b2.js";import{_ as f}from"./category-a7345ec9.js";import{_ as y}from"./Product-391f8ba4.js";import{b as g,e as b}from"./coupon-08220fc3.js";import{_ as h,f as V}from"./index-0e3e5afc.js";import{ap as j,$ as v,o as k,c as x,P as C,S as U,Q as w,W as D,Y as I,T as z,a as F,a9 as $,X as q,bb as N,b9 as P}from"./@vue-76da2f05.js";import"./@vueuse-90d34f35.js";import"./lodash-es-3f297d7c.js";import"./async-validator-cf877c1f.js";import"./dayjs-13b7e569.js";import"./call-bind-6a1b7bd0.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-9f5f6982.js";import"./@popperjs-b78c3215.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./product-edd059db.js";import"./vue-router-590ae0e4.js";import"./pinia-58dabe83.js";import"./vue-demi-71ba0ef2.js";import"./axios-85bcd05e.js";import"./vue-ueditor-wrap-cd890801.js";import"./qs-74887072.js";import"./side-channel-9348fcaa.js";import"./object-inspect-c71aff05.js";const Y={components:{Product:y,Category:f},data:()=>({activeName:"1",form:{coupon_id:"",name:"",color:"",coupon_type:"",reduce_price:"",discount:"",min_price:"",expire_type:"",expire_day:"",active_time:"",total_num:"",show_center:1,sort:1,apply_range:10},list:{},loading:!0,pickerOptions0:{disabledDate:e=>e.getTime()<Date.now()-864e5},is_category:!1,is_product:!1,exclude_ids:[],product_list:[],category_list:{second:[],first:[]},category_ids:[]}),created(){let e=this.$route.query.coupon_id;this.getData(e)},methods:{hasImages:e=>e||"",getData(e){let l=this;g({coupon_id:e}).then((e=>{let a={};if(a=e.data.detail,a.color=e.data.detail.color.value,a.coupon_type=e.data.detail.coupon_type.value,l.form=V(l.form,a),20==l.form.apply_range){l.exclude_ids=e.data.detail.product_ids;for(let e=0;e<l.exclude_ids.length;e++)l.exclude_ids[e]=parseInt(l.exclude_ids[e]);l.product_list=e.data.detail.product_list}30==l.form.apply_range&&(l.category_list=e.data.detail.category_list),l.loading=!1})).catch((e=>{l.loading=!1}))},onSubmit(){let l=this,a=l.form;a.product_ids=l.exclude_ids,a.category_list=l.category_list,l.$refs.form.validate((o=>{if(o){if(20==a.coupon_type&&(a.discount<=0||a.discount>=10))return void e({message:"折扣率介于0和10之间",type:"error"});l.loading=!0,b(a).then((a=>{l.loading=!1,e({message:"恭喜你，修改成功",type:"success"}),l.$router.push("/plus/coupon/index")})).catch((e=>{l.loading=!1}))}else l.loading=!1}))},closeCategoryFunc(e){let l=this;l.is_category=!1,e&&(l.category_list=e)},closeProductFunc(e){let l=this;l.is_product=e.openDialog,"success"==e.type&&e.params.forEach(((e,a)=>{let o={product_id:e.product_id,product_name:e.product_name,product_image:e.product_image};l.exclude_ids.push(o.product_id),l.product_list.push(o)}))},deleteClick(e){this.exclude_ids.splice(e,1),this.product_list.splice(e,1)},cancelFunc(){this.$router.push({path:"/plus/coupon/index"})}}},S=e=>(N("data-v-0bf087da"),e=e(),P(),e),E=S((()=>F("div",{class:"common-form"},"修改优惠券",-1))),M=S((()=>F("div",{class:"tips"},"例如：满100减10",-1))),O={key:0},T={key:1},A=S((()=>F("div",{class:"tips"},"折扣率范围0-10，9.5代表9.5折，整数或1位小数",-1))),Q={key:2},W={key:3},X=S((()=>F("div",{class:"tips"},"限制领取的优惠券数量，-1为不限制",-1))),B=S((()=>F("div",{class:"common-form"},"适用商品",-1))),G=S((()=>F("span",null,"指定商品",-1))),H=S((()=>F("span",null,"指定分类",-1))),J={alt:"",width:50},K={class:"common-button-wrapper"};const L=h(Y,[["render",function(e,g,b,h,V,N){const P=l,Y=a,S=o,L=t,R=d,Z=r,ee=s,le=i,ae=u,oe=p,te=m,de=c,re=n,se=y,ie=f,ue=j("img-url"),pe=_;return v((k(),x("div",null,[C(re,{size:"small",ref:"form",model:V.form,"label-width":"200px"},{default:U((()=>[C(Y,{modelValue:V.activeName,"onUpdate:modelValue":g[0]||(g[0]=e=>V.activeName=e),type:"card"},{default:U((()=>[C(P,{label:"基本信息",name:"1"}),C(P,{label:"适用商品",name:"2"})])),_:1},8,["modelValue"]),"1"==V.activeName?(k(),x(w,{key:0},[E,C(L,{label:"优惠券名称",prop:"name",rules:[{required:!0,message:" "}]},{default:U((()=>[C(S,{modelValue:V.form.name,"onUpdate:modelValue":g[1]||(g[1]=e=>V.form.name=e),placeholder:"请输入优惠券名称"},null,8,["modelValue"]),M])),_:1}),C(L,{label:"优惠券颜色"},{default:U((()=>[C(Z,{modelValue:V.form.color,"onUpdate:modelValue":g[2]||(g[2]=e=>V.form.color=e)},{default:U((()=>[C(R,{label:10},{default:U((()=>[D("蓝色")])),_:1}),C(R,{label:20},{default:U((()=>[D("红色")])),_:1}),C(R,{label:30},{default:U((()=>[D("紫色")])),_:1}),C(R,{label:40},{default:U((()=>[D("黄色")])),_:1})])),_:1},8,["modelValue"])])),_:1}),C(L,{label:"优惠券类型"},{default:U((()=>[C(Z,{modelValue:V.form.coupon_type,"onUpdate:modelValue":g[3]||(g[3]=e=>V.form.coupon_type=e)},{default:U((()=>[C(R,{label:10},{default:U((()=>[D("满减券")])),_:1}),C(R,{label:20},{default:U((()=>[D("折扣券")])),_:1})])),_:1},8,["modelValue"])])),_:1}),10==V.form.coupon_type?(k(),x("div",O,[C(L,{label:"减免金额"},{default:U((()=>[C(S,{modelValue:V.form.reduce_price,"onUpdate:modelValue":g[4]||(g[4]=e=>V.form.reduce_price=e),placeholder:"请输入减免金额",type:"number"},null,8,["modelValue"])])),_:1})])):(k(),x("div",T,[C(L,{label:"折扣率 "},{default:U((()=>[C(S,{modelValue:V.form.discount,"onUpdate:modelValue":g[5]||(g[5]=e=>V.form.discount=e),placeholder:"请输入折扣率",type:"number"},null,8,["modelValue"]),A])),_:1})])),C(L,{label:"最低消费金额"},{default:U((()=>[C(S,{modelValue:V.form.min_price,"onUpdate:modelValue":g[6]||(g[6]=e=>V.form.min_price=e),placeholder:"请输入最低消费金额",type:"number"},null,8,["modelValue"])])),_:1}),C(L,{label:"到期类型"},{default:U((()=>[C(Z,{modelValue:V.form.expire_type,"onUpdate:modelValue":g[7]||(g[7]=e=>V.form.expire_type=e)},{default:U((()=>[C(R,{label:10},{default:U((()=>[D("领取后生效")])),_:1}),C(R,{label:20},{default:U((()=>[D("固定时间")])),_:1})])),_:1},8,["modelValue"])])),_:1}),10==V.form.expire_type?(k(),x("div",Q,[C(L,{label:"有效天数"},{default:U((()=>[C(S,{modelValue:V.form.expire_day,"onUpdate:modelValue":g[8]||(g[8]=e=>V.form.expire_day=e),placeholder:"请输入有效天数",type:"number"},null,8,["modelValue"])])),_:1})])):(k(),x("div",W,[C(L,{label:"有效时间"},{default:U((()=>[C(ee,{modelValue:V.form.active_time,"onUpdate:modelValue":g[9]||(g[9]=e=>V.form.active_time=e),type:"daterange",align:"right","unlink-panels":"","value-format":"YYYY-MM-DD","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":V.pickerOptions0},null,8,["modelValue","picker-options"])])),_:1})])),C(L,{label:"发放总数量 ",prop:"total_num",rules:[{required:!0,message:" "}]},{default:U((()=>[C(S,{modelValue:V.form.total_num,"onUpdate:modelValue":g[10]||(g[10]=e=>V.form.total_num=e),placeholder:"请输入发放总数量",type:"number"},null,8,["modelValue"]),X])),_:1}),C(L,{label:"是否显示在领券中心"},{default:U((()=>[C(Z,{modelValue:V.form.show_center,"onUpdate:modelValue":g[11]||(g[11]=e=>V.form.show_center=e)},{default:U((()=>[C(R,{label:1},{default:U((()=>[D("显示")])),_:1}),C(R,{label:0},{default:U((()=>[D("不显示")])),_:1})])),_:1},8,["modelValue"])])),_:1}),C(L,{label:"排序"},{default:U((()=>[C(S,{type:"number",modelValue:V.form.sort,"onUpdate:modelValue":g[12]||(g[12]=e=>V.form.sort=e),placeholder:"请输入排序"},null,8,["modelValue"])])),_:1})],64)):I("",!0),"2"==V.activeName?(k(),x(w,{key:1},[B,C(L,{label:"选择"},{default:U((()=>[C(Z,{modelValue:V.form.apply_range,"onUpdate:modelValue":g[13]||(g[13]=e=>V.form.apply_range=e)},{default:U((()=>[C(R,{label:10},{default:U((()=>[D("全部商品")])),_:1}),C(R,{label:20},{default:U((()=>[G])),_:1}),C(R,{label:30},{default:U((()=>[H])),_:1})])),_:1},8,["modelValue"])])),_:1}),20==V.form.apply_range?(k(),z(L,{key:0},{default:U((()=>[C(le,{class:"mb10",onClick:g[14]||(g[14]=e=>V.is_product=!0),type:"primary",plain:""},{default:U((()=>[D("添加商品 ")])),_:1}),V.product_list.length>0?(k(),z(oe,{key:0,data:V.product_list,"max-height":"400",border:"",style:{width:"100%"}},{default:U((()=>[C(ae,{prop:"product_id",label:"ID",width:"180"}),C(ae,{prop:"product_name",label:"商品名称",width:"180"}),C(ae,{prop:"image",label:"图片"},{default:U((e=>[v(F("img",J,null,512),[[ue,N.hasImages(e.row.product_image)]])])),_:1}),C(ae,{label:"操作"},{default:U((e=>[C(le,{onClick:l=>N.deleteClick(e.$index),link:"",type:"primary",size:"small"},{default:U((()=>[D("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])):I("",!0)])),_:1})):I("",!0),30==V.form.apply_range?(k(),z(L,{key:1,label:""},{default:U((()=>[C(le,{class:"mb10",onClick:g[15]||(g[15]=e=>V.is_category=!0),type:"primary",plain:""},{default:U((()=>[D("添加分类 ")])),_:1}),C(de,null,{default:U((()=>[V.category_list.first.length>0?(k(!0),x(w,{key:0},$(V.category_list.first,((e,l)=>(k(),z(te,{class:"mr10 mb10",type:"info",size:"large",key:e.category_id},{default:U((()=>[D(q(e.parent?e.parent+"→"+e.name:e.name),1)])),_:2},1024)))),128)):I("",!0),V.category_list.second.length>0?(k(!0),x(w,{key:1},$(V.category_list.second,((e,l)=>(k(),z(te,{class:"mr10 mb10",type:"info",size:"large",key:e.category_id},{default:U((()=>[D(q(e.parent?e.parent+"→"+e.name:e.name),1)])),_:2},1024)))),128)):I("",!0)])),_:1})])),_:1})):I("",!0)],64)):I("",!0),F("div",K,[C(le,{type:"info",size:"small",onClick:N.cancelFunc,loading:V.loading},{default:U((()=>[D("取消")])),_:1},8,["onClick","loading"]),C(le,{type:"primary",size:"small",onClick:N.onSubmit,loading:V.loading},{default:U((()=>[D("提交")])),_:1},8,["onClick","loading"])])])),_:1},8,["model"]),C(se,{isproduct:V.is_product,excludeIds:V.exclude_ids,islist:!0,onCloseDialog:N.closeProductFunc},null,8,["isproduct","excludeIds","onCloseDialog"]),C(ie,{is_category:V.is_category,excludeIds:V.category_ids,onClose:N.closeCategoryFunc},null,8,["is_category","excludeIds","onClose"])])),[[pe,V.loading]])}],["__scopeId","data-v-0bf087da"]]);export{L as default};
